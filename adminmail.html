<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Send Welcome Email ‚Äì CeeMedicoNepal</title>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f7fa;
      padding: 30px;
    }
    h1 {
      color: #4361ee;
      text-align: center;
    }
    table {
      width: 100%;
      max-width: 800px;
      margin: auto;
      background: white;
      border-collapse: collapse;
      border: 1px solid #ddd;
      border-radius: 8px;
      overflow: hidden;
    }
    th, td {
      padding: 12px 15px;
      border-bottom: 1px solid #eee;
      text-align: left;
    }
    th {
      background: #4361ee;
      color: white;
    }
    button {
      background: #2e86de;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #1e6fd2;
    }
    .badge {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 13px;
      color: white;
    }
    .approved { background-color: #2ecc71; }
    .pending { background-color: #e74c3c; }
  </style>
</head>
<body>

<h1>üì¨ Send Welcome Email to Users</h1>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Email</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="userTableBody">
    <tr><td colspan="4">Loading users...</td></tr>
  </tbody>
</table>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyB66MZa0WZk3WPydcjmCDu7P_CE0FD60ug",
    authDomain: "login-2f07b.firebaseapp.com",
    databaseURL: "https://login-2f07b-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "login-2f07b",
    storageBucket: "login-2f07b.appspot.com",
    messagingSenderId: "709252763741",
    appId: "1:709252763741:web:b3902697cc9c8b157a7db4"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  emailjs.init("LovzJI8eoKJ8O2H2e");

  function loadUsers() {
    const tableBody = document.getElementById("userTableBody");
    db.ref("users").once("value").then(snapshot => {
      const users = snapshot.val();
      if (!users) {
        tableBody.innerHTML = "<tr><td colspan='4'>No users found.</td></tr>";
        return;
      }

      tableBody.innerHTML = "";
      Object.entries(users).forEach(([uid, user]) => {
        const tr = document.createElement("tr");

        const nameTd = document.createElement("td");
        nameTd.textContent = user.name || "(No name)";
        tr.appendChild(nameTd);

        const emailTd = document.createElement("td");
        emailTd.textContent = user.email || "(No email)";
        tr.appendChild(emailTd);

        const statusTd = document.createElement("td");
        const badge = document.createElement("span");
        badge.className = "badge " + (user.isApproved ? "approved" : "pending");
        badge.textContent = user.isApproved ? "Approved" : "Pending";
        statusTd.appendChild(badge);
        tr.appendChild(statusTd);

        const actionTd = document.createElement("td");
        const button = document.createElement("button");
        button.textContent = "Send Welcome Email";
        button.onclick = () => sendEmail(user.name, user.email);
        actionTd.appendChild(button);
        tr.appendChild(actionTd);

        tableBody.appendChild(tr);
      });
    });
  }

  function sendEmail(name, email) {
    const htmlContent = `
      <table style="font-family: Arial, sans-serif; max-width: 600px; margin: auto; border: 1px solid #e0e0e0; padding: 20px; background: #ffffff; border-radius: 8px;">
        <tr>
          <td>
            <h2 style="color: #4361ee;">üöÄ Welcome to CeeMedicoNepal.xyz</h2>
            <p style="font-size: 16px; color: #333;">
              Hi ${name || "Student"},<br><br>
              We hope your preparation for the <strong>CEE/NEET exams</strong> is going strong!
            </p>
            <p style="font-size: 16px; color: #333;">
              At <a href="https://ceemediconepal.xyz" style="color: #4361ee;"><strong>CeeMedicoNepal.xyz</strong></a>, we are committed to helping you succeed with high-quality, exam-targeted resources.
            </p>

            <div style="background-color: #f1f3ff; padding: 15px; margin: 20px 0; border-left: 5px solid #4361ee; border-radius: 4px;">
              <strong style="font-size: 18px; color: #3f37c9;">‚ú® Premium Subscription ‚Äì Only Rs 100</strong>
              <p style="margin-top: 10px; font-size: 15px;">
                We're excited to announce the launch of our <strong>Premium Plan</strong>, designed to give you that extra edge in your medical entrance preparation.
              </p>
            </div>

            <p style="font-size: 16px; color: #333;">
              üì± Contact us on WhatsApp: <a href="https://wa.me/9779812240229" style="color: #2e86de;">+977 9812240229</a>
            </p>

            <p style="font-size: 14px; color: #888;">
              Best of luck with your studies!<br>
              ‚Äì Team CeeMedicoNepal
            </p>
          </td>
        </tr>
      </table>
    `;

    emailjs.send("service_h4czyfx", "template_z8piizr", {
      user_name: name || "Student",
      user_email: email,
      message: htmlContent
    }).then(() => {
      alert("‚úÖ Email sent to " + email);
    }).catch(error => {
      console.error("Email error:", error);
      alert("‚ùå Failed to send email.");
    });
  }

  loadUsers();
</script>

</body>
</html>
