<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CEE Medico chapter-wise Quiz</title>
  <style>
    /* Base Styles */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Modern font */
      margin: 0;
      background: #f8f8f8; /* Lighter background */
      line-height: 1.6;
      color: #333; /* Darker text for readability */
    }
    header, footer {
      background-color: #003366;
      color: white;
      padding: 15px 20px; /* Increased padding */
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Subtle shadow */
    }
    h1 {
      margin: 0;
      font-size: 2em; /* Larger heading */
    }
    nav {
      display: flex;
      justify-content: center;
      gap: 20px; /* Increased gap */
      margin-top: 10px;
      flex-wrap: wrap;
    }
    nav a {
      color: white;
      text-decoration: none;
      font-weight: bold;
      padding: 8px 15px; /* More padding for links */
      border-radius: 5px; /* Rounded corners for links */
      transition: background-color 0.3s ease; /* Smooth transition */
    }
    nav a:hover {
      background-color: #004488; /* Darker on hover */
    }
    main {
      max-width: 900px; /* Increased max-width */
      margin: 25px auto; /* Increased margin */
      background: white;
      padding: 30px; /* Increased padding */
      border-radius: 12px; /* More rounded corners */
      box-shadow: 0 4px 15px rgba(0,0,0,0.1); /* More prominent shadow */
    }
    h2 {
      text-align: center;
      color: #003366;
      margin-bottom: 25px; /* Increased margin */
      font-size: 1.8em;
    }
    input[type="text"], button {
      padding: 12px; /* Increased padding */
      margin: 8px 0; /* Adjusted margin */
      width: calc(100% - 24px); /* Account for padding */
      box-sizing: border-box;
      border: 1px solid #ccc; /* Lighter border */
      border-radius: 8px; /* Rounded corners */
      font-size: 1em; /* Consistent font size */
    }
    button {
      background-color: #0056b3;
      color: white;
      cursor: pointer;
      border: none;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #004494;
    }
    .option-btn {
      display: block;
      padding: 15px; /* More padding for options */
      margin: 8px 0;
      background-color: #e0f2f7; /* Light blue background for options */
      border: 1px solid #b3e5fc; /* Slightly darker blue border for options */
      cursor: pointer;
      text-align: left;
      width: 100%;
      box-sizing: border-box;
      border-radius: 8px;
      transition: background-color 0.2s ease, border-color 0.2s ease;
      font-size: 1.1em; /* Slightly larger text for options */
      color: #003366; /* Dark blue text for options */
    }
    .option-btn:hover {
      background-color: #b3e5fc; /* Darker blue on hover */
      border-color: #81d4fa; /* Even darker blue border on hover */
    }
    .hidden {
      display: none;
    }
    #explanation {
      margin-top: 15px;
      font-weight: bold;
      text-align: center;
      padding: 10px;
      border-radius: 8px;
    }
    #explanation.correct {
      color: #1a7d3b; /* Darker green */
      background-color: #e6ffe6; /* Light green background */
    }
    #explanation.incorrect {
      color: #b30000; /* Darker red */
      background-color: #ffe6e6; /* Light red background */
    }
    #question-num {
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 10px;
      color: #555;
    }
    #question-text {
      font-size: 1.3em;
      margin-bottom: 20px;
      color: #222;
      font-weight: 500;
    }
    footer p {
      margin: 0;
      padding: 10px 0;
    }

    /* Responsive Adjustments (Media Queries) */
    @media (max-width: 768px) {
      h1 {
        font-size: 1.8em;
      }
      h2 {
        font-size: 1.5em;
      }
      main {
        margin: 15px;
        padding: 20px;
      }
      nav {
        flex-direction: column;
        gap: 8px;
      }
      nav a {
        padding: 10px;
        border-bottom: 1px solid rgba(255,255,255,0.15);
      }
      nav a:last-child {
        border-bottom: none;
      }
      input[type="text"], button, .option-btn {
        padding: 10px;
        font-size: 0.95em;
      }
      .option-btn {
        font-size: 1em;
      }
    }

    @media (max-width: 480px) {
      header, footer {
        padding: 10px 15px;
      }
      h1 {
        font-size: 1.3em;
      }
      h2 {
        font-size: 1.2em;
        margin-bottom: 15px;
      }
      main {
        margin: 10px;
        padding: 15px;
        border-radius: 8px;
      }
      nav a {
        padding: 8px;
      }
      input[type="text"], button, .option-btn {
        padding: 8px;
        font-size: 0.9em;
        margin: 6px 0;
      }
      .option-btn {
        font-size: 0.95em;
      }
      #question-num {
        font-size: 1.1em;
      }
      #question-text {
        font-size: 1.2em;
        margin-bottom: 15px;
      }
      #explanation {
        padding: 8px;
        font-size: 0.9em;
      }
    }
  </style>
</head>
<body>

  <header>
    <h1>CEE Medico Nepal</h1>
    <nav>
      <a href="/">Home</a>
      <a href="/about.html">About</a>
      <a href="/secure/protected">Premium</a>
      <a href="/secure/login">Login</a>
    </nav>
  </header>

  <main>
    <h2>📘 Generate 50 Quiz Questions</h2>
    <input type="text" id="chapter" placeholder="Enter Chapter Name (e.g., Laws of Motion)" />
    <button onclick="generateQuiz()">Generate Quiz</button>

    <div id="quiz-container" class="hidden">
      <div id="question-num"></div>
      <div id="question-text"></div>
      <div id="options-container"></div>
      <button onclick="nextQuestion()">Next</button>
      <p id="explanation"></p>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 CEE Medico Nepal. All rights reserved.</p>
  </footer>

  <script>
    let quizData = [];
    let currentIndex = 0;

    async function generateQuiz() {
      const chapter = document.getElementById("chapter").value.trim();
      if (!chapter) {
        alert("Please enter a chapter name.");
        return;
      }

      // Basic input validation to prevent excessively long prompts
      if (chapter.length > 100) {
        alert("Chapter name is too long. Please keep it concise.");
        return;
      }

      // Show a loading indicator (optional but good for UX)
      const generateButton = document.querySelector('button[onclick="generateQuiz()"]');
      generateButton.innerText = "Generating...";
      generateButton.disabled = true;

      // Use the provided API key directly in the fetch request
      const apiKey = "AIzaSyD8HWf_Zp0WsS14RJ2vxTUxjXvPCyiNpDo";
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

      const prompt = `
Generate 50 NEET and CEE-level multiple choice questions in JSON format on the chapter "${chapter}" based on NEB syllabus. Use this format:
[
  {
    "question": "1. Sample question?",
    "options": ["A) Option A", "B) Option B", "C) Option C", "D) Option D"],
    "correct": 1,
    "explanation": "Explanation here."
  },
  // ... (up to 50 questions)
]
Ensure questions are clear, options are distinct, and explanations are concise and accurate.
`;

      try {
        const payload = {
            contents: [{ role: "user", parts: [{ text: prompt }] }],
            generationConfig: {
                responseMimeType: "application/json",
                responseSchema: {
                    type: "ARRAY",
                    items: {
                        type: "OBJECT",
                        properties: {
                            "question": { "type": "STRING" },
                            "options": {
                                "type": "ARRAY",
                                "items": { "type": "STRING" }
                            },
                            "correct": { "type": "NUMBER" },
                            "explanation": { "type": "STRING" }
                        },
                        "propertyOrdering": ["question", "options", "correct", "explanation"]
                    }
                }
            }
        };

        const response = await fetch(apiUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
            const errorBody = await response.json();
            throw new Error(`API error: ${response.status} ${response.statusText} - ${errorBody.message || 'Unknown error'}`);
        }

        const result = await response.json();
        const rawJson = result.candidates[0].content.parts[0].text;

        // Directly parse the JSON as it's expected to be structured
        quizData = JSON.parse(rawJson);

        if (quizData.length === 0) {
            alert("❌ No questions were generated. The chapter might be too obscure or the API response was empty/malformed.");
            return;
        }
        currentIndex = 0;
        showQuestion();
      } catch (err) {
        alert("❌ Error generating quiz: " + err.message + ". Please try again or check your API key/quota.");
        console.error("Quiz generation error:", err);
      } finally {
        generateButton.innerText = "Generate Quiz";
        generateButton.disabled = false;
      }
    }

    function showQuestion() {
      if (currentIndex >= quizData.length) {
        alert("🎉 Quiz completed!");
        document.getElementById("quiz-container").classList.add("hidden");
        return;
      }

      const q = quizData[currentIndex];
      document.getElementById("quiz-container").classList.remove("hidden");
      document.getElementById("question-num").innerText = `Question ${currentIndex + 1} of ${quizData.length}`;
      document.getElementById("question-text").innerText = q.question;

      const explanationElement = document.getElementById("explanation");
      explanationElement.innerText = "";
      explanationElement.className = ""; // Clear previous classes

      const optionsBox = document.getElementById("options-container");
      optionsBox.innerHTML = ""; // Clear previous options

      q.options.forEach((opt, i) => {
        const btn = document.createElement("button");
        btn.innerText = opt;
        btn.className = "option-btn";
        btn.onclick = () => {
          // Disable all options after one is selected
          Array.from(optionsBox.children).forEach(optionBtn => {
            optionBtn.disabled = true;
          });

          const isCorrect = i === q.correct;
          if (isCorrect) {
            explanationElement.innerText = "✅ Correct! " + (q.explanation || "");
            explanationElement.classList.add("correct");
          } else {
            explanationElement.innerText = "❌ Incorrect! The correct answer was " + q.options[q.correct] + ". " + (q.explanation || "");
            explanationElement.classList.add("incorrect");
            btn.style.backgroundColor = '#ffcdd2'; /* Lighter red for incorrect choice */
          }
          optionsBox.children[q.correct].style.backgroundColor = '#c8e6c9'; /* Lighter green for correct choice */
        };
        optionsBox.appendChild(btn);
      });
    }

    function nextQuestion() {
      currentIndex++;
      showQuestion();
    }
  </script>
</body>
</html>
