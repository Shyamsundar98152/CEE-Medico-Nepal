<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="description" content="Best MBBS entrance preparation resources for CEE Nepal. Practice MCQs, mock tests, notes, and subject-wise questions for Chemistry, Physics, Botany, and Zoology.">
    <meta name="keywords" content="CEE Nepal, MBBS Entrance,Chapter-wise mcq,cee mcq,ceemediconepal chapter wise, MBBS Nepal,AC-circuits, Medical Entrance Nepal, CEE MCQs, MBBS MCQs, CEE Mock Tests, CEE Chemistry, CEE Physics, CEE Botany, CEE Zoology, CEE MAT, MBBS Practice Questions, ceemediconepal, Nepal Medical Council, CEE 2081, CEE Syllabus, CEE Preparation, CEE Model Questions">
    <meta name="robots" content="index, follow">

    <!-- Removed external fevicon and ad scripts for self-contained environment -->

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>CEE Medico chapter-wise Quiz</title>
    <style>
        /* Base Styles */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Modern font */
            margin: 0;
            background: #f8f8f8; /* Lighter background */
            line-height: 1.6;
            color: #333; /* Darker text for readability */
        }
        header, footer {
            background-color: #003366;
            color: white;
            padding: 15px 20px; /* Increased padding */
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Subtle shadow */
        }
        h1 {
            margin: 0;
            font-size: 2em; /* Larger heading */
        }
        nav {
            display: flex;
            justify-content: center;
            gap: 20px; /* Increased gap */
            margin-top: 10px;
            flex-wrap: wrap;
        }
        nav a {
            color: white;
            text-decoration: none;
            font-weight: bold;
            padding: 8px 15px; /* More padding for links */
            border-radius: 5px; /* Rounded corners for links */
            transition: background-color 0.3s ease; /* Smooth transition */
        }
        nav a:hover {
            background-color: #004488; /* Darker on hover */
        }
        main {
            max-width: 900px; /* Increased max-width */
            margin: 25px auto; /* Increased margin */
            background: white;
            padding: 30px; /* Increased padding */
            border-radius: 12px; /* More rounded corners */
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); /* More prominent shadow */
        }
        h2 {
            text-align: center;
            color: #003366;
            margin-bottom: 25px; /* Increased margin */
            font-size: 1.8em;
        }
        input[type="text"], button {
            padding: 12px; /* Increased padding */
            margin: 8px 0; /* Adjusted margin */
            width: calc(100% - 24px); /* Account for padding */
            box-sizing: border-box;
            border: 1px solid #ccc; /* Lighter border */
            border-radius: 8px; /* Rounded corners */
            font-size: 1em; /* Consistent font size */
        }
        button {
            background-color: #0056b3;
            color: white;
            cursor: pointer;
            border: none;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #004494;
        }
        .option-btn {
            display: block;
            padding: 15px; /* More padding for options */
            margin: 8px 0;
            background-color: #e0f2f7; /* Light blue background for options */
            border: 1px solid #b3e5fc; /* Slightly darker blue border for options */
            cursor: pointer;
            text-align: left;
            width: 100%;
            box-sizing: border-box;
            border-radius: 8px;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            font-size: 1.1em; /* Slightly larger text for options */
            color: #003366; /* Dark blue text for options */
        }
        .option-btn:hover {
            background-color: #b3e5fc; /* Darker blue on hover */
            border-color: #81d4fa; /* Even darker blue border on hover */
        }
        .hidden {
            display: none;
        }
        #explanation {
            margin-top: 15px;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
        }
        #explanation.correct {
            color: #1a7d3b; /* Darker green */
            background-color: #e6ffe6; /* Light green background */
        }
        #explanation.incorrect {
            color: #b30000; /* Darker red */
            background-color: #ffe6e6; /* Light red background */
        }
        #question-num {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #555;
        }
        #question-text {
            font-size: 1.3em;
            margin-bottom: 20px;
            color: #222;
            font-weight: 500;
        }
        #quiz-results {
            margin-top: 20px;
            padding: 20px;
            background-color: #f0f8ff;
            border: 1px solid #cceeff;
            border-radius: 10px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            color: #003366;
        }
        #quiz-results p {
            margin: 10px 0;
        }
        #quiz-results .score-correct {
            color: #1a7d3b;
        }
        #quiz-results .score-wrong {
            color: #b30000;
        }
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            gap: 10px; /* Space between buttons */
        }
        .navigation-buttons button {
            flex: 1; /* Distribute space evenly */
            width: auto; /* Override default button width */
        }
        #countdown-timer {
            font-size: 1.5em;
            font-weight: bold;
            color: #d32f2f; /* Red color for timer */
            text-align: center;
            margin-bottom: 15px;
        }
        footer p {
            margin: 0;
            padding: 10px 0;
        }

        /* Responsive Adjustments (Media Queries) */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }
            h2 {
                font-size: 1.5em;
            }
            main {
                margin: 15px;
                padding: 20px;
            }
            nav {
                flex-direction: column;
                gap: 8px;
            }
            nav a {
                padding: 10px;
                border-bottom: 1px solid rgba(255,255,255,0.15);
            }
            nav a:last-child {
                border-bottom: none;
            }
            input[type="text"], button, .option-btn {
                padding: 10px;
                font-size: 0.95em;
            }
            .option-btn {
                font-size: 1em;
            }
            #quiz-results {
                font-size: 1em;
                padding: 15px;
            }
            .navigation-buttons {
                flex-wrap: wrap; /* Allow buttons to wrap on smaller screens */
            }
            .navigation-buttons button {
                width: 100%; /* Full width on small screens */
            }
        }

        @media (max-width: 480px) {
            header, footer {
                padding: 10px 15px;
            }
            h1 {
                font-size: 1.3em;
            }
            h2 {
                font-size: 1.2em;
                margin-bottom: 15px;
            }
            main {
                margin: 10px;
                padding: 15px;
                border-radius: 8px;
            }
            nav a {
                padding: 8px;
            }
            input[type="text"], button, .option-btn {
                padding: 8px;
                font-size: 0.9em;
                margin: 6px 0;
            }
            .option-btn {
                font-size: 0.95em;
            }
            #question-num {
                font-size: 1.1em;
            }
            #explanation {
                padding: 8px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>CEE Medico Nepal</h1>
        <nav>
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/secure/protected">Premium</a>
            <a href="/secure/login">Login</a>
        </nav>
    </header>

    <main>
        <h2>ðŸ“˜ Chapter-wise Quiz Questions</h2>
        <input type="text" id="chapter" placeholder="Enter Chapter Name (e.g., Laws of Motion)" />
        <button onclick="generateQuiz()">Load Quiz</button>

        <div id="quiz-container" class="hidden">
            <div id="countdown-timer"></div>
            <div id="question-num"></div>
            <div id="question-text"></div>
            <div id="options-container"></div>
            <p id="explanation"></p>
            <div class="navigation-buttons">
                <button id="previous-button" onclick="previousQuestion()">Previous</button>
                <button id="skip-button" onclick="skipQuestion()">Skip</button>
                <button id="next-button" onclick="nextQuestion()">Next</button>
                <button id="submit-button" class="hidden" onclick="submitQuiz()">Submit Quiz</button>
            </div>
        </div>

        <div id="quiz-results" class="hidden">
            <h3>Quiz Results</h3>
            <p>Total Questions: <span id="total-questions-result"></span></p>
            <p class="score-correct">Correct Answers: <span id="correct-answers-result"></span></p>
            <p class="score-wrong">Wrong Answers: <span id="wrong-answers-result"></span></p>
            <p>Skipped Questions: <span id="skipped-questions-result"></span></p>
            <p>Your Score: <span id="final-score-result"></span> / <span id="max-score-result"></span></p>
            <button onclick="location.reload()">Start New Quiz</button>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 CEE Medico Nepal. All rights reserved.</p>
    </footer>

    <script>
        let quizData = [];
        let currentIndex = 0;
        // Use an empty string for the API key; the environment will populate it at runtime.
        const apiKey = "";
        let countdownInterval; // Variable to store the countdown interval ID

        // Utility function for exponential backoff retry logic (required for robust API calls)
        async function fetchWithRetry(url, options, maxRetries = 3) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) {
                        return response;
                    }
                    if (response.status === 429) { // Rate limit or transient error
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    }
                    // For other non-429 non-OK errors, throw immediately
                    throw new Error(`HTTP error ${response.status}: ${response.statusText}`);
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
            throw new Error("Failed to fetch after maximum retries.");
        }

        async function generateQuiz() {
            const chapter = document.getElementById("chapter").value.trim();
            if (!chapter) {
                // Use a custom message box instead of alert()
                document.getElementById("explanation").innerText = "Please enter a chapter name to generate the quiz.";
                document.getElementById("explanation").className = "incorrect";
                return;
            }

            if (chapter.length > 100) {
                document.getElementById("explanation").innerText = "Chapter name is too long. Please keep it concise.";
                document.getElementById("explanation").className = "incorrect";
                return;
            }

            const generateButton = document.querySelector('button[onclick="generateQuiz()"]');
            generateButton.innerText = "Loading..."; // Change button text to Loading
            generateButton.disabled = true;

            // Using the recommended model and API key structure
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            // Updated prompt for 50 questions
            const prompt = `
Generate 50 NEET and CEE-Hard and Long level multiple choice questions in JSON format on the chapter "${chapter}" based on NEB and MEC syllabus Nepal. Use this format:
[
  {
    "question": "1. Sample question?",
    "options": ["A) Option A", "B) Option B", "C) Option C", "D) Option D"],
    "correct": 1,
    "explanation": "Explanation here."
  },
  // ... (up to 50 questions)
]
Ensure questions are clear, options are distinct, and explanations are concise and accurate. Use LaTeX for any mathematical or scientific notation.
`;

            try {
                const payload = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "ARRAY",
                            items: {
                                type: "OBJECT",
                                properties: {
                                    "question": { "type": "STRING" },
                                    "options": {
                                        "type": "ARRAY",
                                        "items": { "type": "STRING" }
                                    },
                                    "correct": { "type": "NUMBER" },
                                    "explanation": { "type": "STRING" }
                                },
                                "propertyOrdering": ["question", "options", "correct", "explanation"]
                            }
                        }
                    }
                };

                const response = await fetchWithRetry(apiUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const rawJson = result.candidates[0].content.parts[0].text;

                // Parse the JSON and initialize question state
                quizData = JSON.parse(rawJson).map(q => ({
                    ...q,
                    userAnswerIndex: null, // Stores the index of the option selected by the user
                    isAnswered: false,    // True if the user has selected an option
                    isSkipped: false      // True if the user explicitly skipped this question
                }));

                if (quizData.length === 0) {
                    document.getElementById("explanation").innerText = "âŒ No questions were generated. The chapter might be too obscure or the API response was empty/malformed.";
                    document.getElementById("explanation").className = "incorrect";
                    return;
                }
                
                currentIndex = 0;
                document.getElementById("quiz-results").classList.add("hidden"); // Hide results if visible
                showQuestion();
            } catch (err) {
                document.getElementById("explanation").innerText = "âŒ Error generating quiz: " + err.message + ". Please try again.";
                document.getElementById("explanation").className = "incorrect";
                console.error("Quiz generation error:", err);
            } finally {
                // Correctly reset the button text to "Load Quiz"
                generateButton.innerText = "Load Quiz";
                generateButton.disabled = false;
            }
        }

        function startCountdown() {
            let timeLeft = 60; // Increased countdown time to 60 seconds (1 minute) for CEE-level questions
            const timerDisplay = document.getElementById("countdown-timer");
            timerDisplay.classList.remove("hidden"); 

            // Clear any existing interval to prevent multiple timers running
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }

            countdownInterval = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                const paddedSeconds = seconds < 10 ? '0' + seconds : seconds;
                
                timerDisplay.innerText = `Time left: ${minutes}:${paddedSeconds}`;
                
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    timerDisplay.innerText = "Time's up! Moving to the next question.";
                    // Automatically skip the question if time runs out
                    if (currentIndex < quizData.length) {
                        // Mark as skipped if not answered
                        if (!quizData[currentIndex].isAnswered) {
                            quizData[currentIndex].isSkipped = true;
                        }
                        currentIndex++;
                        showQuestion();
                    }
                    return;
                }
                timeLeft--;
            }, 1000);
        }

        function showQuestion() {
            // Hide quiz results if visible
            document.getElementById("quiz-results").classList.add("hidden");
            document.getElementById("quiz-container").classList.remove("hidden");
            document.getElementById("explanation").className = "hidden"; // Hide explanation initially

            // Update navigation button visibility
            document.getElementById("previous-button").disabled = currentIndex === 0;
            document.getElementById("next-button").classList.remove("hidden");
            document.getElementById("skip-button").classList.remove("hidden");
            document.getElementById("submit-button").classList.add("hidden");

            if (currentIndex >= quizData.length) {
                // If all questions are shown, show submit button
                document.getElementById("next-button").classList.add("hidden");
                document.getElementById("skip-button").classList.add("hidden");
                document.getElementById("submit-button").classList.remove("hidden");
                clearInterval(countdownInterval); // Stop timer when quiz is finished
                document.getElementById("countdown-timer").classList.add("hidden"); // Hide timer
                return;
            }

            const q = quizData[currentIndex];
            document.getElementById("question-num").innerText = `Question ${currentIndex + 1} of ${quizData.length}`;
            document.getElementById("question-text").innerText = q.question;

            const explanationElement = document.getElementById("explanation");
            explanationElement.innerText = "";
            explanationElement.className = ""; // Clear previous classes

            const optionsBox = document.getElementById("options-container");
            optionsBox.innerHTML = ""; // Clear previous options

            // Create buttons and check for previous state
            q.options.forEach((opt, i) => {
                const btn = document.createElement("button");
                btn.innerText = opt;
                btn.className = "option-btn";
                btn.onclick = () => { selectOption(i); }; // Use a dedicated function for option selection
                
                // If question has been answered, disable and style buttons
                if (q.isAnswered) {
                    btn.disabled = true;
                    if (i === q.userAnswerIndex) {
                        btn.style.backgroundColor = (i === q.correct) ? '#c8e6c9' : '#ffcdd2';
                    }
                    if (i === q.correct && i !== q.userAnswerIndex) {
                        btn.style.backgroundColor = '#c8e6c9'; // Highlight correct answer
                    }
                }
                optionsBox.appendChild(btn);
            });

            // Restore previous explanation
            if (q.isAnswered) {
                const isCorrect = q.userAnswerIndex === q.correct;
                explanationElement.innerText = (isCorrect ? "âœ… Correct! " : "âŒ Incorrect! The correct answer was " + q.options[q.correct] + ". ") + (q.explanation || "");
                explanationElement.classList.add(isCorrect ? "correct" : "incorrect");
                explanationElement.classList.remove("hidden");
            } else if (q.isSkipped) {
                explanationElement.innerText = "This question was skipped.";
                explanationElement.classList.remove("correct", "incorrect", "hidden"); 
            }
            
            // Only start the timer if the question hasn't been answered yet
            if (!q.isAnswered) {
                startCountdown(); 
            } else {
                clearInterval(countdownInterval);
                document.getElementById("countdown-timer").classList.add("hidden"); 
            }
        }

        function selectOption(selectedIndex) {
            const q = quizData[currentIndex];

            // If already answered, do nothing
            if (q.isAnswered) return;

            // Mark question as answered
            q.isAnswered = true;
            q.userAnswerIndex = selectedIndex;
            q.isSkipped = false; // If answered, it's no longer skipped

            highlightAnswer(selectedIndex, q.correct);

            const explanationElement = document.getElementById("explanation");
            const isCorrect = selectedIndex === q.correct;
            explanationElement.innerText = (isCorrect ? "âœ… Correct! " : "âŒ Incorrect! The correct answer was " + q.options[q.correct] + ". ") + (q.explanation || "");
            explanationElement.classList.add(isCorrect ? "correct" : "incorrect");
            explanationElement.classList.remove("hidden");

            // Disable all options after selection
            Array.from(document.getElementById("options-container").children).forEach(optionBtn => {
                optionBtn.disabled = true;
            });
            clearInterval(countdownInterval); // Stop timer when an option is selected
            document.getElementById("countdown-timer").classList.add("hidden"); 
        }

        function highlightAnswer(selectedIndex, correctIndex) {
            const optionsBox = document.getElementById("options-container");
            // Highlight user's choice
            if (optionsBox.children[selectedIndex]) {
                optionsBox.children[selectedIndex].style.backgroundColor = (selectedIndex !== correctIndex) ? '#ffcdd2' : '#c8e6c9'; 
            }
            // Highlight the correct answer (will overwrite incorrect choice if they are the same)
            if (optionsBox.children[correctIndex]) {
                optionsBox.children[correctIndex].style.backgroundColor = '#c8e6c9'; /* Lighter green for correct choice */
            }
        }

        function nextQuestion() {
            // If current question hasn't been answered or explicitly skipped, mark it as skipped
            if (!quizData[currentIndex].isAnswered && !quizData[currentIndex].isSkipped) {
                quizData[currentIndex].isSkipped = true;
            }

            currentIndex++;
            showQuestion();
        }

        function previousQuestion() {
            if (currentIndex > 0) {
                currentIndex--;
                showQuestion();
            }
        }

        function skipQuestion() {
            // Mark current question as skipped if it hasn't been answered
            if (!quizData[currentIndex].isAnswered) {
                quizData[currentIndex].isSkipped = true;
                quizData[currentIndex].userAnswerIndex = null; // Ensure no answer is recorded
            }
            currentIndex++;
            showQuestion();
        }

        function submitQuiz() {
            // Ensure the last question's state is recorded if it's the last one and not answered/skipped
            if (currentIndex < quizData.length && !quizData[currentIndex].isAnswered && !quizData[currentIndex].isSkipped) {
                quizData[currentIndex].isSkipped = true;
            }

            document.getElementById("quiz-container").classList.add("hidden"); // Hide quiz
            document.getElementById("quiz-results").classList.remove("hidden"); // Show results
            clearInterval(countdownInterval); // Stop timer on submit
            document.getElementById("countdown-timer").classList.add("hidden"); // Hide timer

            let finalCorrect = 0;
            let finalWrong = 0;
            let finalSkipped = 0;

            quizData.forEach(q => {
                if (q.isAnswered) {
                    if (q.userAnswerIndex === q.correct) {
                        finalCorrect++;
                    } else {
                        finalWrong++;
                    }
                } else { // This covers both q.isSkipped and questions not interacted with
                    finalSkipped++;
                }
            });

            document.getElementById("total-questions-result").innerText = quizData.length;
            document.getElementById("correct-answers-result").innerText = finalCorrect;
            document.getElementById("wrong-answers-result").innerText = finalWrong;
            document.getElementById("skipped-questions-result").innerText = finalSkipped;
            document.getElementById("final-score-result").innerText = finalCorrect;
            document.getElementById("max-score-result").innerText = quizData.length;
        }
    </script>
</body>
</html>
