<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: #0f172a;
            color: #f8fafc;
        }

        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .loader {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .image-container {
            aspect-ratio: 16 / 9;
            background: #1e293b;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border-radius: 0.75rem;
        }

        .glow-button {
            transition: all 0.3s ease;
            box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5);
        }

        .glow-button:hover:not(:disabled) {
            box-shadow: 0 0 20px 2px rgba(59, 130, 246, 0.4);
            transform: translateY(-1px);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 md:p-8">

    <div class="max-w-4xl w-full space-y-8">
        <!-- Header -->
        <div class="text-center space-y-2">
            <h1 class="text-4xl font-bold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
                AI Image Studio
            </h1>
            <p class="text-slate-400">Generate high-definition 16:9 cinematic visuals</p>
        </div>

        <!-- Main Interface -->
        <div class="glass p-6 rounded-2xl shadow-2xl space-y-6">
            
            <!-- Prompt Area -->
            <div class="space-y-2">
                <div class="flex justify-between items-end">
                    <label class="text-sm font-medium text-slate-300">Detailed Prompt</label>
                    <span id="charCount" class="text-xs text-slate-500">0 / 3000 characters</span>
                </div>
                <textarea 
                    id="promptInput" 
                    maxlength="3000"
                    placeholder="Describe your masterpiece in detail (e.g., A futuristic cyberpunk city at sunset, neon lights reflecting in puddles, cinematic lighting, 8k resolution...)"
                    class="w-full h-32 bg-slate-900/50 border border-slate-700 rounded-xl p-4 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all resize-none text-slate-200 placeholder:text-slate-600"
                ></textarea>
            </div>

            <!-- Action Button -->
            <button 
                id="generateBtn"
                onclick="generateImage()"
                class="glow-button w-full bg-blue-600 hover:bg-blue-500 text-white font-semibold py-4 rounded-xl flex items-center justify-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed"
            >
                <span id="btnText">Generate 1280x720 Image</span>
                <div id="btnLoader" class="loader hidden"></div>
            </button>

            <!-- Result Area -->
            <div id="resultWrapper" class="hidden space-y-4">
                <div class="image-container border border-slate-700 group relative">
                    <img id="outputImage" src="" alt="Generated artwork" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                        <p class="text-white text-sm font-medium">16:9 HD Render</p>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row gap-4">
                    <button 
                        onclick="downloadImage()"
                        class="flex-1 bg-slate-800 hover:bg-slate-700 py-3 rounded-lg border border-slate-600 transition-colors flex items-center justify-center gap-2"
                    >
                        <span>Download JPG</span>
                    </button>
                    <button 
                        onclick="copyToClipboard()"
                        class="flex-1 bg-slate-800 hover:bg-slate-700 py-3 rounded-lg border border-slate-600 transition-colors flex items-center justify-center gap-2"
                    >
                        <span>Copy Prompt</span>
                    </button>
                </div>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="hidden p-4 bg-red-900/20 border border-red-500/50 rounded-lg text-red-400 text-sm"></div>
        </div>

        <!-- Info Footer -->
        <div class="flex flex-wrap justify-center gap-6 text-xs text-slate-500 uppercase tracking-widest">
            <div class="flex items-center gap-2">
                <div class="w-1.5 h-1.5 rounded-full bg-green-500"></div>
                Model: Imagen 4.0
            </div>
            <div class="flex items-center gap-2">
                <div class="w-1.5 h-1.5 rounded-full bg-blue-500"></div>
                Ratio: 16:9
            </div>
            <div class="flex items-center gap-2">
                <div class="w-1.5 h-1.5 rounded-full bg-purple-500"></div>
                Size: ~1.5MB
            </div>
        </div>
    </div>

    <script>
        const apiKey = ""; // Runtime provides key
        const promptInput = document.getElementById('promptInput');
        const charCount = document.getElementById('charCount');
        const generateBtn = document.getElementById('generateBtn');
        const btnText = document.getElementById('btnText');
        const btnLoader = document.getElementById('btnLoader');
        const resultWrapper = document.getElementById('resultWrapper');
        const outputImage = document.getElementById('outputImage');
        const errorMessage = document.getElementById('errorMessage');

        // Character counter logic
        promptInput.addEventListener('input', () => {
            const len = promptInput.value.length;
            charCount.textContent = `${len} / 3000 characters`;
            if (len >= 2900) {
                charCount.classList.add('text-orange-400');
            } else {
                charCount.classList.remove('text-orange-400');
            }
        });

        async function generateImage() {
            const prompt = promptInput.value.trim();
            if (!prompt) return;

            // UI Reset
            toggleLoading(true);
            errorMessage.classList.add('hidden');
            
            // Refine prompt for 16:9 and quality
            // We append instructions to the model to ensure the correct aspect ratio and quality
            const enhancedPrompt = `${prompt}, aspect ratio 16:9, highly detailed, photorealistic, 4k resolution, cinematic lighting`;

            let retries = 0;
            const maxRetries = 5;
            
            const callApi = async () => {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            instances: [{ prompt: enhancedPrompt }],
                            parameters: { 
                                sampleCount: 1,
                                // Note: The model output is typically optimized for standard resolutions.
                                // It generates high-quality files usually around 1-2MB.
                            }
                        })
                    });

                    if (!response.ok) throw new Error('Generation failed');

                    const result = await response.json();
                    if (result.predictions && result.predictions[0]) {
                        const base64Data = result.predictions[0].bytesBase64Encoded;
                        outputImage.src = `data:image/png;base64,${base64Data}`;
                        resultWrapper.classList.remove('hidden');
                        toggleLoading(false);
                    } else {
                        throw new Error('No image returned');
                    }
                } catch (error) {
                    if (retries < maxRetries) {
                        const delay = Math.pow(2, retries) * 1000;
                        retries++;
                        setTimeout(callApi, delay);
                    } else {
                        showError("We encountered an issue generating your image. Please try again in a moment.");
                        toggleLoading(false);
                    }
                }
            };

            callApi();
        }

        function toggleLoading(isLoading) {
            generateBtn.disabled = isLoading;
            if (isLoading) {
                btnText.textContent = "Creating Visuals...";
                btnLoader.classList.remove('hidden');
            } else {
                btnText.textContent = "Generate 1280x720 Image";
                btnLoader.classList.add('hidden');
            }
        }

        function showError(msg) {
            errorMessage.textContent = msg;
            errorMessage.classList.remove('hidden');
        }

        function downloadImage() {
            const link = document.createElement('a');
            link.href = outputImage.src;
            link.download = `ai-masterpiece-${Date.now()}.png`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function copyToClipboard() {
            const el = document.createElement('textarea');
            el.value = promptInput.value;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            
            const originalText = btnText.textContent;
            btnText.textContent = "Prompt Copied!";
            setTimeout(() => btnText.textContent = originalText, 2000);
        }
    </script>
</body>
</html>
