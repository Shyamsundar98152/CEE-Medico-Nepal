<!DOCTYPE html>
<html lang="en">
<head>
   <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3108357597736981"
     crossorigin="anonymous"></script>



    
   
    <link rel="apple-touch-icon" sizes="180x180" href="/fevicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/fevicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/fevicon/favicon-16x16.png">
<link rel="manifest" href="/fevicon/site.webmanifest">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EEKWY5Y4G3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EEKWY5Y4G3');
</script>
   
   

  <meta name="description" content="Prepare for CEE and MBBS entrance exams in Nepal with CEE Medico Nepal. Practice medical quizzes, MCQs, and mock tests designed for medical aspirants.">
  <meta name="keywords" content="CEE Medico Nepal,CEE Nepal,Cee Medical Nepal xyz quiz, medical quiz nepal,cee quiz nepal CEE Nepal 2081, CEE medical entrance, CEE entrance preparation, CEE Nepal MCQs, CEE model questions, CEE mock test Nepal, MEC entrance Nepal, Medical entrance Nepal, MEC entrance model papers, Free CEE medical practice set, Biology MCQs for CEE, Chemistry entrance questions Nepal, Physics CEE questions, Zoology MCQs for CEE, Botany MCQs for CEE, NEET-style questions Nepal, NEET-level mock test Nepal, Solved CEE model questions, CEE past year questions Nepal, Online CEE preparation Nepal, CEE 2081 biology questions and answers, How to pass CEE Nepal exam, MEC entrance science model questions, Best app for CEE preparation Nepal, ceemediconepal.xyz, CeeMedico Nepal app, ceemediconepal entrance quiz, cee nepal entrance mock test, cee entrance preparation app Nepal, practice MCQ app Nepal, cee entrance solution Nepal, cee exam 2082 online test, cee 2082 model set MBBS quiz, medical quiz, CEE entrance Nepal, medical entrance preparation, CEE Nepal MCQs, NEB entrance quiz, MBBS entrance Nepal">
   <meta property="og:title" content="CEE Medico Nepal - MCQ Quiz Platform">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Daily Quiz — CEE Medico Nepal</title>
<meta name="description" content="Daily scheduled chapter quiz — auto loads chapter by time and saves participant results locally" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<style>
  /* Base Styles */
  :root{
    --blue: #003366;
    --accent: #0056b3;
    --card: #ffffff;
    --muted: #6b7280;
    --green: #16a34a;
    --red: #ef4444;
    --light-green: #d1fae5;
    --light-red: #ffe4e6;
    --border-color: #e6eef8;
  }
  *{box-sizing:border-box}
  body{
    font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    margin:0;
    background:#f3f6fb;
    color:#0f172a; /* Default text color (dark/black-ish) */
    line-height: 1.6;
  }
  /* Original header/footer styles removed or overridden for new design */
  main{
    max-width:980px;
    margin:20px auto;
    padding:18px;
  }
  .card{
    background:var(--card); /* White background for cards */
    border-radius:12px;
    padding:18px;
    box-shadow:0 6px 18px rgba(2,6,23,0.06);
    margin-bottom:16px;
  }
  h1{margin:0;font-size:1.6rem}
  h2{color:var(--blue); margin:6px 0 14px; font-size:1.4rem}
  h3{margin-top:0; font-size:1.2rem; color:var(--blue);}

  /* Layout and Controls */
  .row{
    display:flex;
    gap:12px;
    align-items:center;
    flex-wrap: wrap; /* Allows wrapping on smaller screens */
  }
  .col{flex:1; min-width: 150px;} /* Ensure column has minimum width */
  #chapter-title{font-weight:600; font-size:1.1rem;}
  .meta{color:var(--muted); font-size:0.95rem}
  .controls{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    margin-top:10px;
    justify-content: center; /* Center buttons horizontally */
  }
  input[type="text"], button, select {
    padding:10px 15px;
    border-radius:8px;
    border:1px solid var(--border-color);
    font-size:1rem;
    width: 100%; /* Full width for inputs */
    max-width: 100%;
  }
  button{
    background:var(--accent);
    color:white;
    border:0;
    cursor:pointer;
    transition: background-color 0.2s ease;
  }
  button:hover:not([disabled]){
    background: #004085;
  }
  button[disabled]{
    opacity:.6;
    cursor:not-allowed;
  }
  .option-btn{
    display:block;
    width:100%;
    text-align:left;
    padding:12px;
    border-radius:10px;
    border:1px solid var(--border-color);
    margin:8px 0;
    background:var(--card); /* Ensures options background is white */
    color: inherit; /* Inherit body's text color (dark/black-ish) */
    cursor:pointer;
    transition: background-color 0.2s ease, border-color 0.2s ease;
  }
  .option-btn:hover:not([data-answered="true"]){ /* Prevent hover effect after answer */
    background:#f0f0f0; /* Subtle light gray on hover for white background */
  }
  #options-container{margin-top:8px;}
  #quiz-results{
    display:flex;
    flex-direction:column;
    gap:8px;
    align-items:center;
    text-align: center;
  }
  .participant{
    display:flex;
    justify-content:space-between;
    padding:8px 10px;
    border-radius:6px;
    background: #fdfefe;
    border: 1px solid var(--border-color);
    width: 100%;
    margin-bottom: 5px;
  }
  .small{font-size:.9rem;color:var(--muted)}
  .center{text-align:center}
  .hidden{display:none !important;} /* Ensures hidden elements are truly hidden */

  /* Specific Button Styles */
  #submit-btn{background:var(--green);}
  #submit-btn:hover:not([disabled]){background:#137f3a;}
  #restart-btn{background:var(--red);}
  #restart-btn:hover:not([disabled]){background:#b91c1c;}
  #save-result-btn {background: var(--blue);}
  #save-result-btn:hover:not([disabled]) {background: #002244;}

  /* Quiz Area Specifics */
  #countdown {
    font-size: 1.1rem;
    font-weight: bold;
    color: var(--blue);
    margin-bottom: 10px;
  }
  #explanation {
    margin-top: 15px;
    font-style: italic;
    color: #333;
    padding: 10px;
    background: #eaf1f8;
    border-radius: 8px;
    border: 1px solid #d0e0f0;
  }

  /* Modal Styles */
  .modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.6);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  .modal-content {
    background: var(--card);
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    max-width: 400px;
    width: 90%;
    text-align: center;
    position: relative; /* For the close button */
  }
  .modal-close-btn {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 1.5rem;
    cursor: pointer;
    background: none;
    border: none;
    color: var(--muted);
    padding: 0;
  }
  .modal-close-btn:hover {
    color: var(--accent);
  }
  .modal-content button {
    margin-top: 20px;
    padding: 10px 20px;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    width: auto; /* Reset width for modal buttons */
  }

  /* New Header Styles */
  header {
    background: var(--blue);
    color: #fff;
    padding: 10px 0;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    position: relative; /* Needed for mobile menu positioning */
    z-index: 50; /* Ensure header is above other content */
  }

  .header-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .logo {
    display: flex;
    align-items: center;
    flex-shrink: 0; /* Prevent logo from shrinking */
  }

  .logo img {
    height: 50px; /* Adjust as needed */
    margin-right: 10px;
    border-radius: 8px; /* Slightly rounded corners for the logo image */
  }

  .logo-text h1 {
    font-size: 1.5rem;
    margin: 0;
  }

  .logo-text p {
    font-size: 0.9rem;
    margin: 0;
    color: rgba(255, 255, 255, 0.8);
  }

  nav ul {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
  }

  nav ul li {
    position: relative;
    margin-left: 25px;
  }

  nav ul li a {
    color: #fff;
    text-decoration: none;
    font-weight: 600;
    padding: 10px 0;
    display: block;
    transition: color 0.3s ease;
  }

  nav ul li a:hover {
    color: var(--accent);
  }

  .dropdown-menu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    background: var(--blue);
    min-width: 160px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    z-index: 1;
    border-radius: 8px;
    overflow: hidden; /* Ensures child elements respect border-radius */
  }

  .dropdown:hover .dropdown-menu {
    display: block;
  }

  .dropdown-menu li {
    margin: 0;
    padding: 0;
  }

  .dropdown-menu li a {
    padding: 12px 15px;
    white-space: nowrap;
    transition: background-color 0.3s ease;
  }

  .dropdown-menu li a:hover {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
  }

  .mobile-menu-btn {
    display: none; /* Hidden by default on desktop */
    background: none;
    border: none;
    color: #fff;
    font-size: 1.8rem;
    cursor: pointer;
  }

  /* New Footer Styles */
  footer {
    background: var(--blue);
    color: #fff;
    padding: 40px 0 20px;
    font-size: 0.9rem;
    margin-top: 40px;
  }

  .footer-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
    gap: 30px; /* Gap between columns */
  }

  .footer-col {
    flex: 1;
    min-width: 200px;
    margin-bottom: 20px;
  }

  .footer-col .logo img {
    height: 40px;
    margin-right: 8px;
  }

  .footer-col .logo-text h3 {
    font-size: 1.3rem;
    margin: 0;
    color: #fff;
  }

  .footer-col p {
    color: rgba(255, 255, 255, 0.7);
    line-height: 1.5;
    margin-top: 10px;
  }

  .social-links {
    margin-top: 15px;
  }

  .social-links a {
    color: #fff;
    font-size: 1.2rem;
    margin-right: 15px;
    transition: color 0.3s ease;
  }

  .social-links a:hover {
    color: var(--accent);
  }

  .footer-links {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .footer-links li {
    margin-bottom: 8px;
  }

  .footer-links li a {
    color: rgba(255, 255, 255, 0.7);
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .footer-links li a:hover {
    color: #fff;
  }

  .footer-col h3 {
    font-size: 1.1rem;
    margin-bottom: 15px;
    color: #fff;
    position: relative;
    padding-bottom: 5px;
  }

  .footer-col h3::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: 0;
    width: 40px;
    height: 2px;
    background: var(--accent);
  }

  .footer-bottom {
    text-align: center;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.6);
  }

  .footer-col .fa-map-marker-alt,
  .footer-col .fa-phone,
  .footer-col .fa-envelope {
    margin-right: 8px;
    color: var(--accent);
  }

  /* Responsive Adjustments */
  @media (max-width: 992px) {
    .header-container {
      flex-wrap: wrap;
      justify-content: center;
      text-align: center;
    }

    .logo {
      margin-bottom: 15px;
    }

    nav {
      width: 100%;
      order: 3; /* Push nav to the next line */
    }

    nav ul {
      justify-content: center;
    }
  }

  @media (max-width:640px){
    main{padding:10px;}
    .row{flex-direction:column;align-items:stretch;}
    .col{min-width: unset;}
    input[type="text"], button{width: 100%;}
    .controls button{width: calc(50% - 4px);} /* Two buttons per row on small screens */
    .controls button:last-child:nth-child(odd) { width: 100%; } /* Last button full width if odd count */
    h1{font-size:1.3rem;}
    h2{font-size:1.2rem;}
    .option-btn{padding:10px;}

    /* Mobile Menu for Header */
    .mobile-menu-btn {
      display: block; /* Show on mobile */
      position: absolute;
      right: 20px;
      top: 25px;
    }

    nav {
      display: none; /* Hide by default on mobile */
      width: 100%;
      background: var(--blue);
      position: absolute;
      top: 70px; /* Below the header content */
      left: 0;
      padding-bottom: 10px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    nav.active {
      display: block; /* Show when active */
    }

    nav ul {
      flex-direction: column;
      text-align: center;
      padding-top: 10px;
    }

    nav ul li {
      margin: 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    nav ul li:last-child {
      border-bottom: none;
    }

    nav ul li a {
      padding: 15px 0;
    }

    .dropdown-menu {
      position: static; /* Make dropdown expand inline */
      box-shadow: none;
      border-radius: 0;
      background: rgba(0, 0, 0, 0.1); /* Slightly different background for sub-menu */
    }

    .dropdown:hover .dropdown-menu {
        display: block;
    }

    /* Footer adjustments for small screens */
    .footer-container {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
    .footer-col {
      min-width: unset;
      width: 100%;
      margin-bottom: 30px;
    }
    .footer-col h3::after {
      left: 50%;
      transform: translateX(-50%);
    }
    .footer-col .logo {
        justify-content: center;
    }
  }
</style>
</head>
<body>
<header>
    <div class="container header-container">
        <div class="logo">
            <img src="/img/Logo.png" alt="CEE Medico Nepal Logo">
            <div class="logo-text">
                <h1>CEE Medico Nepal</h1>
                <p>MBBS Entrance Preparation</p>
            </div>
        </div>
        <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
        </button>
        <nav id="mainNav">
            <ul>
                <li><a href="index.html">Home</a></li>
                <li class="dropdown">
                    <a href="#">Subjects <i class="fas fa-chevron-down"></i></a>
                    <ul class="dropdown-menu">
                        <li><a href="physics.html">Physics</a></li>
                        <li><a href="chemistry.html">Chemistry</a></li>
                        <li><a href="botany.html">Botany</a></li>
                        <li><a href="zoology.html">Zoology</a></li>
                        <li><a href="mat.html">MAT</a></li>
                    </ul>
                </li>
                <li><a href="about.html">About Us</a></li>
                <li><a href="privacy.html">Privacy</a></li>
                <li><a href="Blog/blog.html">Blog</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="/secure/login.html">Login</a></li>
            </ul>
        </nav>
    </div>
</header>

<main>
  <div class="card">
    <div id="status">
      <div id="chapter-title">Loading schedule...</div>
      <div class="meta" id="schedule-info">Checking local time…</div>
    </div>
    <div style="margin-top:12px" id="controls-area">
      <div class="row">
        <div class="col">
          <input id="participant-name" type="text" placeholder="Your name (optional for local result)" />
        </div>
        <div>
          <button id="join-button" disabled>Wait for quiz</button>
        </div>
      </div>
      <div class="small" style="margin-top:8px">Participant name is for your local reference only. Results are not saved externally.</div>
    </div>
  </div>

  <div id="quiz-area" class="card hidden">
    <div id="countdown" class="small center"></div>
    <div id="question-num" class="small"></div>
    <h2 id="question-text"></h2>
    <div id="options-container"></div>
    <div id="explanation" class="small center"></div>

    <div class="controls" style="margin-top:12px">
      <button id="prev-btn">Previous</button>
      <button id="skip-btn">Skip</button>
      <button id="next-btn">Next</button>
      <button id="submit-btn">Submit Quiz</button>
    </div>
  </div>
 <div id="results-area" class="card hidden">
    <div id="quiz-results">
      <h2 class="center">Quiz Result</h2>
      <div class="center">
        <div>Total Questions: <span id="res-total">0</span></div>
        <div>Correct Answers: <span id="res-correct">0</span></div>
        <div>Wrong Answers: <span id="res-wrong">0</span></div>
        <div>Skipped Questions: <span id="res-skipped">0</span></div>
      </div>
      <div style="margin-top:12px" class="center">
        <button id="save-result-btn">Save Result (Local)</button>
        <button id="restart-btn">Restart Quiz</button>
      </div>
       
      <h3 style="margin-top:20px; margin-bottom: 10px;">Your Local History</h3>
      <div id="local-history-display" style="width:100%;">
        <div class="small center">No previous results saved locally.</div>
      </div>
    </div>
  </div>
   <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3108357597736981"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="fluid"
     data-ad-layout-key="-fb+5w+4e-db+86"
     data-ad-client="ca-pub-3108357597736981"
     data-ad-slot="9545179847"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
  <div class="card">
    <h3 style="margin-top:0">Upcoming Chapters</h3>
    <div id="schedule-display" class="leaderboard">
      No schedule loaded.
    </div>
  </div>


  <div class="card small" id="notes">
    <strong>Notes:</strong> The schedule is embedded within this file. The site uses your **local device's time** for scheduling. Quiz results are **only stored locally** within your browser and are not shared or saved to any external database.
  </div>
</main>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3108357597736981"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="fluid"
     data-ad-layout-key="-fb+5w+4e-db+86"
     data-ad-client="ca-pub-3108357597736981"
     data-ad-slot="9545179847"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<footer>
    <div id="container-0e0ce27e977000960a615021af2cd0e3"></div>
    <div class="container">
        <div class="footer-container">
            <div class="footer-col">
                <div class="logo">
                    <img src="https://placehold.co/40x40/003366/ffffff?text=Logo" alt="CEE Medico Nepal Logo">
                    <div class="logo-text">
                        <h3>CEE Medico Nepal</h3>
                    </div>
                </div>
                <p>Your comprehensive platform for MBBS entrance exam preparation in Nepal.</p>
                <div class="social-links">
                    <a href="https://www.facebook.com/techgy.shyamsundar"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="https://www.instagram.com/shyamsundar98122/"><i class="fab fa-instagram"></i></a>
                    <a href="https://www.youtube.com/@ceemediconepal"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
            <div class="footer-col">
                <h3>Quick Links</h3>
                <ul class="footer-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="#subjects-grid">Subjects</a></li>
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="privacy.html">Privacy</a></li>
                    <li><a href="#">Blog</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3>Subjects</h3>
                <ul class="footer-links">
                    <li><a href="physics.html">Physics</a></li>
                    <li><a href="chemistry.html">Chemistry</a></li>
                    <li><a href="botany.html">Botany</a></li>
                    <li><a href="zoology.html">Zoology</a></li>
                    <li><a href="mat.html">MAT</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3>Contact Us</h3>
                <p><i class="fas fa-map-marker-alt"></i> Kathmandu, Nepal</p>
                <p><i class="fas fa-phone"></i> +977 9812240229</p>
                <p><i class="fas fa-envelope"></i> avik96045@gmail.com</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© 2025 CEE Medico Nepal. All Rights Reserved.</p>
        </div>
    </div>
</footer>

<div id="modal-message-overlay" class="modal-overlay hidden">
  <div class="modal-content">
    <button class="modal-close-btn" id="modal-message-close">&times;</button>
    <p id="modal-message-text"></p>
    <button id="modal-message-ok">OK</button>
  </div>
</div>

<script type="module">
/* =========================
   Firebase Imports & Setup
   ========================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

// Global Firebase instances
let app;
let db;
let auth;
let userId; // Will store the authenticated user's ID

// Firebase configuration (provided by Canvas environment or hardcoded if not available)
const firebaseConfig = {
  apiKey: "AIzaSyBjm8uaVMdylGg3-YKdEKKV6DDbRkaxjiE", // This is the specific API key you provided
  authDomain: "daily-quiz-a29e8.firebaseapp.com",
  databaseURL: "https://daily-quiz-a29e8-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "daily-quiz-a29e8",
  storageBucket: "daily-quiz-a29e8.firebasestorage.app",
  messagingSenderId: "886784418732",
  appId: "1:886784418732:web:0ad368df36f7187d2b1009"
};

const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'; // Use default if not available

/* ========================= EMBEDDED CHAPTERS.TXT CONTENT ========================= */
const EMBEDDED_CHAPTERS_TXT = `2025-08-17 10:00 | Chemistry - Atomic Structure
2025-08-17 13:00 | Physics - Oscillations & Waves
2025-08-17 15:00 | Botany - Biotechnology
2025-08-17 18:00 | Zoology - Biomolecules
2025-08-18 10:00 | Chemistry - Chemical Bonding
2025-08-18 13:00 | Zoology - Human Reproduction
2025-08-18 15:00 | Botany - Plant Kingdom
2025-08-18 18:00 | Physics - Electrostatics
2025-08-19 10:00 | Zoology - Human Physiology - Circulatory System
2025-08-19 13:00 | Physics - Electrostatics
2025-08-19 15:00 | Botany - Plant Physiology
2025-08-19 18:00 | Chemistry - Atomic Structure
2025-08-20 10:00 | Physics - Kinematics
2025-08-20 13:00 | Zoology - Cell Structure & Function
2025-08-20 15:00 | Chemistry - Chemical Bonding
2025-08-20 18:00 | Botany - Biotechnology
2025-08-21 10:00 | Chemistry - States of Matter
2025-08-21 13:00 | Botany - Ecology
2025-08-21 15:00 | Zoology - Human Reproduction
2025-08-21 18:00 | Physics - Kinematics
2025-08-22 10:00 | Botany - Genetics
2025-08-22 13:00 | Zoology - Human Reproduction
2025-08-22 15:00 | Physics - Thermodynamics
2025-08-22 18:00 | Chemistry - Thermodynamics
2025-08-23 10:00 | Botany - Ecology
2025-08-23 13:00 | Zoology - Human Physiology - Circulatory System
2025-08-23 15:00 | Chemistry - Thermodynamics
2025-08-23 18:00 | Physics - Electrostatics
2025-08-24 10:00 | Chemistry - States of Matter
2025-08-24 13:00 | Zoology - Biomolecules
2025-08-24 15:00 | Botany - Genetics
2025-08-24 18:00 | Physics - Oscillations & Waves
2025-08-25 10:00 | Botany - Biotechnology
2025-08-25 13:00 | Physics - Electrostatics
2025-08-25 15:00 | Chemistry - States of Matter
2025-08-25 18:00 | Zoology - Human Physiology - Circulatory System
2025-08-26 10:00 | Physics - Kinematics
2025-08-26 13:00 | Botany - Ecology
2025-08-26 15:00 | Zoology - Human Reproduction
2025-08-26 18:00 | Chemistry - Chemical Bonding
2025-08-27 10:00 | Physics - Kinematics
2025-08-27 13:00 | Botany - Plant Physiology
2025-08-27 15:00 | Chemistry - States of Matter
2025-08-27 18:00 | Zoology - Human Physiology - Circulatory System
2025-08-28 10:00 | Zoology - Cell Structure & Function
2025-08-28 13:00 | Botany - Plant Physiology
2025-08-28 15:00 | Physics - Laws of Motion
2025-08-28 18:00 | Chemistry - States of Matter
2025-08-29 10:00 | Chemistry - Thermodynamics
2025-08-29 13:00 | Zoology - Cell Structure & Function
2025-08-29 15:00 | Botany - Plant Kingdom
2025-08-29 18:00 | Physics - Thermodynamics
2025-08-30 10:00 | Physics - Oscillations & Waves
2025-08-30 13:00 | Botany - Plant Physiology
2025-08-30 15:00 | Chemistry - Chemical Kinetics
2025-08-30 18:00 | Zoology - Human Physiology - Nervous System
2025-08-31 10:00 | Botany - Plant Physiology
2025-08-31 13:00 | Zoology - Human Reproduction
2025-08-31 15:00 | Physics - Work, Energy & Power
2025-08-31 18:00 | Chemistry - Chemical Kinetics
2025-09-01 10:00 | Chemistry - Atomic Structure
2025-09-01 13:00 | Physics - Electrostatics
2025-09-01 15:00 | Botany - Cell Structure & Function
2025-09-01 18:00 | Zoology - Cell Structure & Function
2025-09-02 10:00 | Physics - Thermodynamics
2025-09-02 13:00 | Zoology - Biomolecules
2025-09-02 15:00 | Chemistry - Chemical Kinetics
2025-09-02 18:00 | Botany - Ecology
2025-09-03 10:00 | Physics - Oscillations & Waves
2025-09-03 13:00 | Zoology - Human Physiology - Digestion
2025-09-03 15:00 | Botany - Biotechnology
2025-09-03 18:00 | Chemistry - States of Matter
2025-09-04 10:00 | Chemistry - Thermodynamics
2025-09-04 13:00 | Zoology - Human Reproduction
2025-09-04 15:00 | Botany - Biotechnology
2025-09-04 18:00 | Physics - Work, Energy & Power
2025-09-05 10:00 | Zoology - Cell Structure & Function
2025-09-05 13:00 | Botany - Cell Structure & Function
2025-09-05 15:00 | Chemistry - Chemical Kinetics
2025-09-05 18:00 | Physics - Oscillations & Waves
2025-09-06 10:00 | Chemistry - Electrochemistry
2025-09-06 13:00 | Botany - Biotechnology
2025-09-06 15:00 | Zoology - Biomolecules
2025-09-06 18:00 | Physics - Electrostatics
2025-09-07 10:00 | Chemistry - Electrochemistry
2025-09-07 13:00 | Physics - Thermodynamics
2025-09-07 15:00 | Zoology - Biomolecules
2025-09-07 18:00 | Botany - Genetics
2025-09-08 10:00 | Physics - Electrostatics
2025-09-08 13:00 | Zoology - Human Reproduction
2025-09-08 15:00 | Chemistry - Electrochemistry
2025-09-08 18:00 | Botany - Ecology
2025-09-09 10:00 | Botany - Cell Structure & Function
2025-09-09 13:00 | Zoology - Human Physiology - Circulatory System
2025-09-09 15:00 | Physics - Laws of Motion
2025-09-09 18:00 | Chemistry - Chemical Kinetics
2025-09-10 10:00 | Chemistry - Thermodynamics
2025-09-10 13:00 | Zoology - Biomolecules
2025-09-10 15:00 | Physics - Laws of Motion
2025-09-10 18:00 | Botany - Plant Kingdom
2025-09-11 10:00 | Physics - Electrostatics
2025-09-11 13:00 | Chemistry - Atomic Structure
2025-09-11 15:00 | Botany - Biotechnology
2025-09-11 18:00 | Zoology - Human Physiology - Circulatory System
2025-09-12 10:00 | Zoology - Human Reproduction
2025-09-12 13:00 | Chemistry - States of Matter
2025-09-12 15:00 | Physics - Work, Energy & Power
2025-09-12 18:00 | Botany - Plant Kingdom
2025-09-13 10:00 | Botany - Plant Physiology
2025-09-13 13:00 | Chemistry - Chemical Bonding
2025-09-13 15:00 | Zoology - Human Physiology - Digestion
2025-09-13 18:00 | Physics - Thermodynamics
2025-09-14 10:00 | Physics - Oscillations & Waves
2025-09-14 13:00 | Botany - Ecology
2025-09-14 15:00 | Chemistry - Atomic Structure
2025-09-14 18:00 | Zoology - Cell Structure & Function
2025-09-15 10:00 | Zoology - Biomolecules
2025-09-15 13:00 | Physics - Kinematics
2025-09-15 15:00 | Botany - Biotechnology
2025-09-15 18:00 | Chemistry - Electrochemistry
2025-09-16 10:00 | Physics - Work, Energy & Power
2025-09-16 13:00 | Chemistry - Thermodynamics
2025-09-16 15:00 | Zoology - Human Reproduction
2025-09-16 18:00 | Botany - Plant Kingdom
2025-09-17 10:00 | Botany - Genetics
2025-09-17 13:00 | Physics - Laws of Motion
2025-09-17 15:00 | Zoology - Human Physiology - Nervous System
2025-09-17 18:00 | Chemistry - Chemical Bonding
2025-09-18 10:00 | Zoology - Human Physiology - Digestion
2025-09-18 13:00 | Botany - Plant Physiology
2025-09-18 15:00 | Chemistry - States of Matter
2025-09-18 18:00 | Physics - Thermodynamics
2025-09-19 10:00 | Physics - Electrostatics
2025-09-19 13:00 | Botany - Cell Structure & Function
2025-09-19 15:00 | Chemistry - Chemical Kinetics
2025-09-19 18:00 | Zoology - Biomolecules
2025-09-20 10:00 | Chemistry - Electrochemistry
2025-09-20 13:00 | Physics - Work, Energy & Power
2025-09-20 15:00 | Botany - Ecology
2025-09-20 18:00 | Zoology - Human Reproduction
2025-09-21 10:00 | Zoology - Human Physiology - Circulatory System
2025-09-21 13:00 | Chemistry - Chemical Kinetics
2025-09-21 15:00 | Physics - Kinematics
2025-09-21 18:00 | Botany - Genetics
2025-09-22 10:00 | Physics - Oscillations & Waves
2025-09-22 13:00 | Botany - Biotechnology
2025-09-22 15:00 | Chemistry - Thermodynamics
2025-09-22 18:00 | Zoology - Cell Structure & Function
2025-09-23 10:00 | Zoology - Biomolecules
2025-09-23 13:00 | Zoology - Human Physiology - Nervous System
2025-09-23 15:00 | Chemistry - Chemical Kinetics
2025-09-23 18:00 | Botany - Genetics
2025-09-24 10:00 | Physics - Oscillations & Waves
2025-09-24 13:00 | Chemistry - Chemical Kinetics
2025-09-24 15:00 | Zoology - Human Physiology - Digestion
2025-09-24 18:00 | Botany - Plant Physiology
2025-09-25 10:00 | Chemistry - Thermodynamics
2025-09-25 13:00 | Zoology - Biomolecules
2025-09-25 15:00 | Physics - Kinematics
2025-09-25 18:00 | Botany - Cell Structure & Function
2025-09-26 10:00 | Botany - Cell Structure & Function
2025-09-26 13:00 | Physics - Work, Energy & Power
2025-09-26 15:00 | Chemistry - States of Matter
2025-09-26 18:00 | Zoology - Human Physiology - Digestion
2025-09-27 10:00 | Physics - Work, Energy & Power
2025-09-27 13:00 | Zoology - Human Physiology - Nervous System
2025-09-27 15:00 | Botany - Genetics
2025-09-27 18:00 | Chemistry - Chemical Kinetics
`;

/* =========================
   Quiz Question Data
   ========================= */
const QUIZ_DATA = {};
const LAST_QUIZ_DATA = {}; // To cache the last quiz data fetched/generated


/* =========================
   HELPER FUNCTIONS
   ========================= */
const el = id => document.getElementById(id);
const show = el => el.classList.remove('hidden');
const hide = el => el.classList.add('hidden');
const hasClass = (el, cls) => el.classList.contains(cls);

function showMessage(message, isError = false) {
    const modalTextEl = el('modal-message-text');
    modalTextEl.innerText = message;
    if (isError) {
        modalTextEl.style.color = 'var(--red)';
    } else {
        modalTextEl.style.color = 'inherit';
    }
    show(el('modal-message-overlay'));
}

function parseSchedule(scheduleText) {
  const schedule = {};
  const lines = scheduleText.split('\n').filter(line => line.trim() !== '');
  lines.forEach(line => {
    const parts = line.split('|').map(p => p.trim());
    if (parts.length === 2) {
      const dateTime = parts[0].trim();
      const chapter = parts[1].trim();
      schedule[dateTime] = chapter;
    }
  });
  return schedule;
}

// Function to find the next scheduled chapter
function findCurrentChapter(schedule) {
    const now = new Date();
    const sortedDates = Object.keys(schedule).sort();
    let currentChapter = null;
    let nextChapterTime = null;

    for (let i = 0; i < sortedDates.length; i++) {
        const dateTimeStr = sortedDates[i];
        const scheduleTime = new Date(dateTimeStr.replace(' ', 'T'));
        if (scheduleTime > now) {
            currentChapter = {
                chapter: schedule[dateTimeStr],
                time: scheduleTime
            };
            nextChapterTime = scheduleTime;
            break;
        }
    }
    return currentChapter;
}


let countdownInterval;
function startCountdown(endTime) {
  const countdownEl = el('countdown');
  clearInterval(countdownInterval);

  function updateCountdown() {
    const now = new Date();
    const timeLeft = endTime - now;
    if (timeLeft <= 0) {
      countdownEl.innerText = 'Quiz is Live!';
      clearInterval(countdownInterval);
      el('join-button').disabled = false;
      el('join-button').innerText = 'Join Quiz';
      return;
    }
    const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
    const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

    let countdownText = "Quiz starts in ";
    if (days > 0) countdownText += `${days}d `;
    if (hours > 0 || days > 0) countdownText += `${hours}h `;
    countdownText += `${minutes}m ${seconds}s`;
    countdownEl.innerText = countdownText;
  }
  updateCountdown();
  countdownInterval = setInterval(updateCountdown, 1000);
}

// Render the entire schedule table
function renderScheduleTable(schedule) {
  const scheduleDisplayEl = el('schedule-display');
  const sortedDates = Object.keys(schedule).sort();
  if (sortedDates.length === 0) {
    scheduleDisplayEl.innerHTML = '<div class="small center">No upcoming schedule found.</div>';
    return;
  }

  const tableHtml = `
    <table style="width:100%; border-collapse: collapse; margin-top: 10px;">
      <thead>
        <tr style="background-color: var(--blue); color: white;">
          <th style="padding: 10px; text-align: left; border-radius: 8px 0 0 0;">Date</th>
          <th style="padding: 10px; text-align: left; border-radius: 0 8px 0 0;">Chapter & Time</th>
        </tr>
      </thead>
      <tbody>
        ${sortedDates.map((date, index) => {
          const rowClass = index % 2 === 0 ? 'even' : 'odd';
          const [dateStr, timeStr] = date.split(' ');
          const formattedDate = new Date(dateStr).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' });
          const formattedTime = new Date(`1970/01/01 ${timeStr}`).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });

          return `
            <tr style="background-color: var(--card); border-bottom: 1px solid var(--border-color);">
              <td style="padding: 10px; vertical-align: top; font-weight: bold; white-space: nowrap;">${formattedDate}</td>
              <td style="padding: 10px;">${schedule[date]} <div class="small" style="color:var(--muted)">at ${formattedTime}</div></td>
            </tr>
          `;
        }).join('')}
      </tbody>
    </table>
  `;

  scheduleDisplayEl.innerHTML = tableHtml;
}

/* =========================
   Quiz Logic
   ========================= */

let currentQuizState = {
  questions: [],
  currentQuestionIndex: 0,
  score: 0,
  skipped: 0
};

function renderQuiz(questions, index) {
  const question = questions[index];
  if (!question) return;

  el('question-num').innerText = `Question ${index + 1} of ${questions.length}`;
  el('question-text').innerText = question.question;

  const optionsContainer = el('options-container');
  optionsContainer.innerHTML = '';
  question.options.forEach((option, i) => {
    const btn = document.createElement('button');
    btn.className = 'option-btn';
    btn.dataset.index = i;
    btn.innerHTML = option;
    btn.onclick = () => selectOption(i);
    optionsContainer.appendChild(btn);
  });
  
  el('explanation').innerText = ''; // Clear previous explanation
  el('submit-btn').disabled = true; // Disable submit until all questions are answered

  // Update navigation button states
  el('prev-btn').disabled = index === 0;
  el('next-btn').disabled = index === questions.length - 1;
  el('skip-btn').disabled = (index === questions.length - 1) && !currentQuizState.questions.some(q => q.skipped);
}

function selectOption(selectedIndex) {
  const currentQuestion = currentQuizState.questions[currentQuizState.currentQuestionIndex];
  if (currentQuestion.answered) {
    return; // Do nothing if already answered
  }

  currentQuestion.answered = true;
  currentQuestion.userAnswer = selectedIndex;

  const optionBtns = el('options-container').querySelectorAll('.option-btn');
  optionBtns.forEach((btn, i) => {
    btn.dataset.answered = 'true'; // Lock all buttons
    if (i === selectedIndex) {
      if (selectedIndex === currentQuestion.correctAnswer) {
        btn.style.backgroundColor = 'var(--light-green)';
        btn.style.borderColor = 'var(--green)';
        currentQuizState.score++;
      } else {
        btn.style.backgroundColor = 'var(--light-red)';
        btn.style.borderColor = 'var(--red)';
        // Highlight correct answer
        optionBtns[currentQuestion.correctAnswer].style.backgroundColor = 'var(--light-green)';
        optionBtns[currentQuestion.correctAnswer].style.borderColor = 'var(--green)';
      }
    }
  });

  // Display explanation if available
  if (currentQuestion.explanation) {
    const explanationEl = el('explanation');
    explanationEl.innerHTML = `<strong>Explanation:</strong> ${currentQuestion.explanation}`;
    show(explanationEl);
  }

  updateQuizControls();
}

function updateQuizControls() {
  const currentQuestion = currentQuizState.questions[currentQuizState.currentQuestionIndex];
  const allAnswered = currentQuizState.questions.every(q => q.answered || q.skipped);

  el('submit-btn').disabled = !allAnswered;

  if (currentQuestion.answered) {
    el('skip-btn').disabled = true;
  } else {
    el('skip-btn').disabled = false;
  }
}

function showResult() {
  hide(el('quiz-area'));
  show(el('results-area'));

  el('res-total').innerText = currentQuizState.questions.length;
  el('res-correct').innerText = currentQuizState.score;
  el('res-wrong').innerText = currentQuizState.questions.length - currentQuizState.score - currentQuizState.skipped;
  el('res-skipped').innerText = currentQuizState.skipped;
}

function restartQuiz() {
  hide(el('results-area'));
  show(el('controls-area'));
  hide(el('quiz-area'));
  currentQuizState = { questions: [], currentQuestionIndex: 0, score: 0, skipped: 0 };
}


function generateMCQs(chapterName){
  // This is a placeholder for generating questions based on chapter name.
  // In a real application, this would call an API (e.g., Gemini API) to generate questions.
  // For this demo, we'll return a static set of questions based on a simple check.
  console.log(`Generating MCQs for: ${chapterName}`);
  return Promise.resolve([
    {
      "question": "What is the primary function of an HTML file?",
      "options": [
        "To define the structure and content of a web page.",
        "To style a web page.",
        "To add interactivity to a web page.",
        "To manage a server's database."
      ],
      "correctAnswer": 0,
      "explanation": "HTML stands for HyperText Markup Language and is used to create the basic structure and elements of a web page, such as headings, paragraphs, and links."
    },
    {
      "question": "Which tag is used to create a hyperlink in HTML?",
      "options": [
        "<a>",
        "<link>",
        "<hlink>",
        "<href>"
      ],
      "correctAnswer": 0,
      "explanation": "The `<a>` tag defines a hyperlink. The `href` attribute within the `<a>` tag specifies the URL the link goes to."
    },
    {
      "question": "What does CSS stand for?",
      "options": [
        "Computer Style Sheets",
        "Creative Style Syntax",
        "Cascading Style Sheets",
        "Custom Style Standards"
      ],
      "correctAnswer": 2,
      "explanation": "CSS (Cascading Style Sheets) is a stylesheet language used to describe the presentation of a document written in a markup language like HTML."
    },
    {
      "question": "How do you include JavaScript in an HTML file?",
      "options": [
        "Using the `<js>` tag",
        "Using the `<script>` tag",
        "Using the `<javascript>` tag",
        "Using the `<src>` tag"
      ],
      "correctAnswer": 1,
      "explanation": "The `<script>` tag is used to embed or reference executable code, most commonly JavaScript, within an HTML document."
    }
  ]);
}

/* =========================
   Firestore and Authentication
   ========================= */
async function initializeFirebaseAndAuth() {
    try {
        if (!app) {
            app = initializeApp(firebaseConfig, 'default-app-id');
            auth = getAuth(app);
            db = getFirestore(app);
        }

        if (initialAuthToken) {
            await signInWithCustomToken(auth, initialAuthToken);
        } else {
            const userCredential = await signInAnonymously(auth);
            userId = userCredential.user.uid;
        }

        return new Promise((resolve) => {
            const unsubscribe = onAuthStateChanged(auth, (user) => {
                if (user) {
                    userId = user.uid;
                    console.log("Firebase Auth State Changed: User is signed in with UID", userId);
                    unsubscribe();
                    resolve(user);
                } else {
                    console.log("Firebase Auth State Changed: No user is signed in.");
                    resolve(null);
                }
            });
        });
    } catch (e) {
        console.error("Firebase Auth or Firestore Initialization Error:", e);
        throw e;
    }
}


async function saveQuizToFirestore(chapter, quizData) {
    if (!userId) {
        console.warn("User not authenticated. Cannot save quiz to Firestore.");
        return;
    }
    const quizDocRef = doc(db, 'quizzes', chapter.replace(/[^a-zA-Z0-9]/g, '_'));
    try {
        await setDoc(quizDocRef, {
            data: quizData,
            createdAt: new Date(),
            source: 'gemini'
        });
        console.log("Quiz data successfully written to Firestore!");
    } catch (e) {
        console.error("Error writing document: ", e);
    }
}

async function getQuizFromFirestore(chapter) {
    if (!userId) {
        console.warn("User not authenticated. Cannot fetch quiz from Firestore.");
        return null;
    }
    const quizDocRef = doc(db, 'quizzes', chapter.replace(/[^a-zA-Z0-9]/g, '_'));
    try {
        const docSnap = await getDoc(quizDocRef);
        if (docSnap.exists()) {
            console.log("Found quiz data in Firestore.");
            return docSnap.data().data;
        } else {
            console.log("No such quiz document in Firestore!");
            return null;
        }
    } catch (e) {
        console.error("Error getting document:", e);
        return null;
    }
}


/* =========================
   Local Storage Management for History
   ========================= */

const LOCAL_HISTORY_KEY = 'cee-medico-quiz-history';

function saveResultLocally(result) {
    let history = JSON.parse(localStorage.getItem(LOCAL_HISTORY_KEY) || '[]');
    history.push(result);
    localStorage.setItem(LOCAL_HISTORY_KEY, JSON.stringify(history));
    renderLocalHistory();
    showMessage('Your result has been saved locally!', false);
}

function renderLocalHistory() {
    const historyDisplayEl = el('local-history-display');
    const history = JSON.parse(localStorage.getItem(LOCAL_HISTORY_KEY) || '[]');

    if (history.length === 0) {
        historyDisplayEl.innerHTML = '<div class="small center">No previous results saved locally.</div>';
        return;
    }
    
    // Reverse the order to show most recent first
    const sortedHistory = history.reverse();
    const listHtml = sortedHistory.map(entry => `
        <div class="participant">
            <div>
                <strong>${entry.name || 'Anonymous'}</strong>
                <div class="small">${entry.chapter}</div>
            </div>
            <div>
                <strong style="color:var(--green)">${entry.score}/${entry.total}</strong>
                <div class="small">${new Date(entry.timestamp).toLocaleDateString()}</div>
            </div>
        </div>
    `).join('');

    historyDisplayEl.innerHTML = listHtml;
}


/* =========================
   Event Listeners
   ========================= */
el('join-button').onclick = () => {
  hide(el('controls-area'));
  show(el('quiz-area'));
  currentQuizState.questions = [...LAST_QUIZ_DATA]; // Use a fresh copy
  currentQuizState.currentQuestionIndex = 0;
  currentQuizState.score = 0;
  currentQuizState.skipped = 0;
  renderQuiz(currentQuizState.questions, currentQuizState.currentQuestionIndex);
};

el('prev-btn').onclick = () => {
  if (currentQuizState.currentQuestionIndex > 0) {
    currentQuizState.currentQuestionIndex--;
    renderQuiz(currentQuizState.questions, currentQuizState.currentQuestionIndex);
  }
};

el('next-btn').onclick = () => {
  if (currentQuizState.currentQuestionIndex < currentQuizState.questions.length - 1) {
    currentQuizState.currentQuestionIndex++;
    renderQuiz(currentQuizState.questions, currentQuizState.currentQuestionIndex);
  } else {
    // If it's the last question, show results
    showResult();
  }
};

el('skip-btn').onclick = () => {
  const currentQuestion = currentQuizState.questions[currentQuizState.currentQuestionIndex];
  if (!currentQuestion.answered) {
    currentQuestion.skipped = true;
    currentQuizState.skipped++;
    currentQuizState.currentQuestionIndex++;
    if (currentQuizState.currentQuestionIndex < currentQuizState.questions.length) {
      renderQuiz(currentQuizState.questions, currentQuizState.currentQuestionIndex);
    } else {
      showResult();
    }
  }
};

el('submit-btn').onclick = () => showResult();
el('restart-btn').onclick = restartQuiz;

el('save-result-btn').onclick = () => {
    const name = el('participant-name').value || 'Anonymous';
    const result = {
        name,
        chapter: el('chapter-title').innerText,
        score: currentQuizState.score,
        total: currentQuizState.questions.length,
        timestamp: new Date().toISOString()
    };
    saveResultLocally(result);
};

el('modal-message-close').onclick = () => hide(el('modal-message-overlay'));
el('modal-message-ok').onclick = () => hide(el('modal-message-overlay'));

el('mobileMenuBtn').addEventListener('click', () => {
  el('mainNav').classList.toggle('active');
});

/* =========================
   MAIN APPLICATION LOGIC
   ========================= */

async function main() {
  try{
    const schedule = parseSchedule(EMBEDDED_CHAPTERS_TXT);
    renderScheduleTable(schedule);
    const currentChapter = findCurrentChapter(schedule);

    if (!currentChapter) {
        el('chapter-title').innerText = 'No upcoming quizzes scheduled.';
        el('schedule-info').innerText = 'Please check back later for new schedules.';
        el('join-button').disabled = true;
        el('join-button').innerText = 'No Quiz Available';
        hide(el('quiz-area'));
        hide(el('results-area'));
        renderLocalHistory();
        return;
    }

    el('chapter-title').innerText = currentChapter.chapter;
    el('schedule-info').innerText = `Scheduled for: ${currentChapter.time.toLocaleDateString()} at ${currentChapter.time.toLocaleTimeString()}`;

    // Show countdown timer
    startCountdown(currentChapter.time);
    el('join-button').disabled = true;

    // Initialize Firebase and Auth
    await initializeFirebaseAndAuth();

    // Fetch quiz questions from Firestore
    let quizData = await getQuizFromFirestore(currentChapter.chapter);
    if (quizData) {
        LAST_QUIZ_DATA = quizData.map(q => ({ ...q, answered:false, userAnswer:null, skipped:false }));
        el('join-button').innerText = 'Join Quiz (Loaded from Firestore)';
        el('join-button').disabled = false;
    } else {
        // If not found in Firestore, generate using Gemini
        quizData = await generateMCQs(currentChapter.chapter);
        // Ensure structure and add initial state for each question
        quizData = quizData.map(q => ({ ...q, answered:false, userAnswer:null, skipped:false }));
        // Save the newly generated quiz data to Firestore
        await saveQuizToFirestore(currentChapter.chapter, quizData);
        LAST_QUIZ_DATA = quizData;
        el('join-button').innerText = 'Join Quiz (Generated & Cached)';
        el('join-button').disabled = false;
    }

    // Do NOT show quiz area here, it will be shown when 'Join Quiz' is clicked.
  }catch(e){
    el('chapter-title').innerText = `Error processing questions: ${e.message || e}`;
    el('join-button').innerText = 'Retry';
    el('join-button').disabled = false;
    el('join-button').onclick = ()=> location.reload();
    hide(el('quiz-area')); // Hide quiz area on error
  }
  renderLocalHistory(); // Display existing local history on load
}

// Start the main application logic when the page loads
document.addEventListener('DOMContentLoaded', main);

/* =========================
   small helper: escape html
   ========================= */
function escapeHtml(str){
  return String(str).replace(/[&<>\"']/g, s=>({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',"'":'&#39;'})[s]);
}

</script>
</body>
</html>
